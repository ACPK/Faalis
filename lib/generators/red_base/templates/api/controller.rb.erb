class API::V1::<%= resource.pluralize %>Controller < RedBase::APIController
  before_filter :build_resource, :only => :create
  load_and_authorize_resource :except => [:destory]

  # GET /api/v1/<%= resource.pluralize.underscore %>
  def index
  end

  def create
    <% fields.each do |name, type| %><% if type == "has_many" %>
    <%= name.underscore %> = <%= name.singularize.camelize %>.where({:id => params[:<%= resource.underscore %>][:<%= name %>]})
    @<%= resource.underscore %>.<%= name.underscore %> = <%= name.underscore %>
    <% end %><% end %>
    if @<%= resource.underscore %>.save
        @<%= resource.underscore %>
    else
        @<%= resource.underscore %>.errors
    end
  end

  def show
  end

  def update
    <% fields.each do |name, type| %><% if type == "has_many" %>
    <%= name.underscore %> = <%= name.singularize.camelize %>.where({:id => params[:<%= resource.underscore %>][:<%= name %>]})
    @<%= resource.underscore %>.<%= name.underscore %> = <%= name.underscore %>
    <% end %><% end %>

    if @<%= resource.underscore %>.update(resource_params)
        @<%= resource.underscore %>
    else
        @<%= resource.underscore %>.errors
    end
  end

  def destroy
    ids = params[:id].split(",")
    @<%= resource.pluralize.underscore %> = ::<%= resource %>.where(:id => ids)
    authorize! :destroy, @<%= resource.pluralize.underscore %>
    @<%= resource.pluralize.underscore %>.destroy_all
  end

  def build_resource
    @<%= resource.underscore %> = ::<%= resource %>.new(resource_params)
  end

  def resource_params
    params.require(:<%= resource.underscore %>).permit(:id<%= fields_as_params(:relations => true) %>)
  end

end
